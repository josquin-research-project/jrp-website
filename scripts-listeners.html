<script>

let JRP = {};


//////////////////////////////
//
// DOMContentLoaded event listener --
//

document.addEventListener("DOMContentLoaded", function () {

	// Audio handling
	AUDIO = document.getElementById("audio");
	if (AUDIO) {
		AUDIO.addEventListener("ended", function () {
			AUDIO.pause();
			const pauseelem = document.getElementById(AUDIOid);
			if (pauseelem) pauseelem.className = "play";
		});
	}

	sessionStorage.removeItem("RECENTLYADDEDHTML");

	const macroid = "AKfycbyeHfmyCHHgbY9X_UDMzW9xyRgqH0c7Ycp76NTW18mjZSnW_2umhgH2ZGDtxuwDot6mKw";
	let url = `https://script.google.com/macros/s/${macroid}/exec`;
	url += "?sheet=works&format=json";

	fetch(url)
		.then(response => {
			if (!response.ok) {
				throw new Error("Request failed with status " + response.status);
			}
			return response.json();
		})
		.then(data => {
			JRP.WORKS = data;

			buildComposerSelect(JRP.WORKS);
			buildGenreSelect();

			if (document.getElementById("sample-music")) {
				displayRandomExample(JRP.WORKS);
			}

			if (document.getElementById("recently-added")) {
				displayRecentAdditions(7, JRP.WORKS);
			}
		})
		.catch(error => {
			console.error("Fetch error:", error.message);
		});

});
</script>